<style>
  .col-left {
    text-align: left;
  }

  .col-right {
    text-align: right;
  }

  .map_wrap {
    position: relative;
    margin: 10px 10px 10px 0;
    height: 250px;
  }

  .title {
    font-weight: bold;
    display: block;
  }

  .btn-custom {
    width: 100%;
    height: 70px;
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 20px;
  }

  .hAddr {
    position: absolute;
    left: 10px;
    top: 10px;
    border-radius: 2px;
    background: #fff;
    background: rgba(255, 255, 255, 0.8);
    z-index: 1;
    padding: 5px;
  }

  #centerAddr {
    display: block;
    margin-top: 2px;
    font-weight: normal;
  }

  .bAddr {
    padding: 5px;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
  }

  .custom_zoomcontrol {
    position: absolute;
    top: 120px;
    right: 20px;
    width: 36px;
    height: 70px;
    overflow: hidden;
    z-index: 1;
    background-color: #f5f5f5;
  }

  .custom_zoomcontrol span {
    display: block;
    width: 36px;
    height: 35px;
    text-align: center;
    cursor: pointer;
  }

  .custom_zoomcontrol span img {
    width: 15px;
    height: 15px;
    margin: 8px;
    margin-right: 10px;
    padding: 0;
    border: none
  }

  .custom_zoomcontrol span:first-child {
    border-bottom: 1px solid #bfbfbf;
  }

  .radius_border {
    border: 1px solid #919191;
    border-radius: 5px;
  }
</style>


<div style="text-align: center; margin-top:10px;margin-bottom:100px">


  <div id="loading" style="position:fixed; width:100%;height:100%;text-align:center;">
    <img style="margin-top:200px ;width:50px;height:50px" src="/assets/img/loading.gif"/>
    <h6>위치를 확인하는 중..</h6>
  </div>

  <div>
    <div class="col-xs-4 col-left">
      <a onclick="history.back()"><span style="font-size:20px" class="glyphicon glyphicon-chevron-left"></span></a>
    </div>
    <div class="col-xs-4">
    </div>
    <div class="col-xs-4 col-right">
      <a><span style="font-size:20px" class="glyphicon glyphicon-question-sign"></span></a>
    </div>
  </div>
  <div>
    <h2 style=" font-family:'맑은고딕'">배송지 선택</h2>
    <h6>희망하는 배송 위치를 클릭해주세요</h6>
  </div>

  <div class="map_wrap" style="margin:10px;">
    <div id="map" style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
    <!--<div class="hAddr">-->
    <!--<span class="title">지도중심기준 행정동 주소정보</span>-->
    <!--<span id="centerAddr"></span>-->
    <!--</div>-->
  </div>

  <!-- 지도 확대, 축소 컨트롤 div 입니다 -->
  <div id="custom_zoom" class="custom_zoomcontrol radius_border" style="display:none">
    <span onclick="map.setLevel(map.getLevel() - 1)"><img
      src="http://i1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_plus.png" alt="확대"></span>
    <span onclick="map.setLevel(map.getLevel() + 1)"><img
      src="http://i1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_minus.png" alt="축소"></span>
  </div>

  <h3 style="display: none;" id="message"></h3>

  <h3 style="display:none;" id="latitude"></h3>

  <h3 style="display:none;" id="longitude"></h3>

  <div id="addrDetail"></div>

  <div class="container" id="btnDiv" style="display:none;margin-top:10px">
    <button class="btn btn-large btn-primary btn-custom" style="" onclick="goNext()">확인</button>
  </div>

  <span id="test1"></span>
</div>

<%-contentFor('script')%>


<script type="text/javascript"
        src="//apis.daum.net/maps/maps3.js?apikey=0bce2b80336cbb209915bf8a9587be8159cb7ce3&libraries=services"></script>

<script>

  var geocoder, marker, map, infowindow, currentAddr, zoomLevel = 2;
  var wpid;
  var DEFAULT_COORDS = {
    latitude: 37.566826,
    longitude: 126.9786567,
    accuracy: 2000
  };

  function map_init(lat, lng) {

    var latitude, longitude;

    if (lat && lng) {
      latitude = lat;
      longitude = lng;
    } else {
      latitude = DEFAULT_COORDS.latitude;
      longitude = DEFAULT_COORDS.longitude;
    }

    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
      mapOption = {
        center: new daum.maps.LatLng(latitude, longitude), // 지도의 중심좌표
        level: zoomLevel // 지도의 확대 레벨
      };

    // 지도를 생성합니다
    map = new daum.maps.Map(mapContainer, mapOption);

    // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
    var zoomControl = new daum.maps.ZoomControl();
    //map.addControl(zoomControl, daum.maps.ControlPosition.RIGHT);


    // 주소-좌표 변환 객체를 생성합니다
    geocoder = new daum.maps.services.Geocoder();

    marker = new daum.maps.Marker(); // 클릭한 위치를 표시할 마커입니다
    infowindow = new daum.maps.InfoWindow({ zindex: 1 }); // 클릭한 위치에 대한 주소를 표시할 인포윈도우입니다

    // 현재 지도 중심좌표로 주소를 검색해서 지도 좌측 상단에 표시합니다
    searchAddrFromCoords(map.getCenter(), displayCenterInfo);


    searchDetailAddrFromCoords(map.getCenter(), checkOnMap(map.getCenter()));

    // 지도를 클릭했을 때 클릭 위치 좌표에 대한 주소정보를 표시하도록 이벤트를 등록합니다
    daum.maps.event.addListener(map, 'click', function (mouseEvent) {
      searchDetailAddrFromCoords(mouseEvent.latLng, checkOnMap(mouseEvent.latLng));
    });

    // 중심 좌표나 확대 수준이 변경됐을 때 지도 중심 좌표에 대한 주소 정보를 표시하도록 이벤트를 등록합니다
    daum.maps.event.addListener(map, 'idle', function () {
      searchAddrFromCoords(map.getCenter(), displayCenterInfo);
    });
  }

  function checkOnMap(coords) {
    return function (status, result) {
      if (status === daum.maps.services.Status.OK) {
        var detailAddr = !!result[0].roadAddress.name ? '<div>도로명주소 : ' + result[0].roadAddress.name + '</div>' : '';
        detailAddr += '<div>지번 주소 : ' + result[0].jibunAddress.name + '</div>';

        var content = '<div class="bAddr">' +
          '<span class="title">주소정보</span>' +
          detailAddr +
          '</div>';

        // 마커를 클릭한 위치에 표시합니다
        marker.setPosition(coords);
        marker.setMap(map);
        //
        //        // 인포윈도우에 클릭한 위치에 대한 법정동 상세 주소정보를 표시합니다
        //        infowindow.setContent(content);
        //        infowindow.open(map, marker);

        document.getElementById('addrDetail').innerHTML = content;
        currentAddr = !!result[0].roadAddress.name ? result[0].roadAddress.name : result[0].jibunAddress.name;
        $('#loading').css('display', 'none');
        $('#btnDiv').css('display', '');
        $('#custom_zoom').css('display','');
      }
    }
  }

  function searchAddrFromCoords(coords, callback) {
    // 좌표로 행정동 주소 정보를 요청합니다
    geocoder.coord2addr(coords, callback);
  }

  function searchDetailAddrFromCoords(coords, callback) {
    // 좌표로 법정동 상세 주소 정보를 요청합니다
    geocoder.coord2detailaddr(coords, callback);
  }

  // 지도 좌측상단에 지도 중심좌표에 대한 주소정보를 표출하는 함수입니다
  function displayCenterInfo(status, result) {
    if (status === daum.maps.services.Status.OK) {
      //      var infoDiv = document.getElementById('centerAddr');
      //      infoDiv.innerHTML = result[0].fullName;
    }
  }


  init();

  function format_time_component(time_component) {
    if (time_component < 10)
      time_component = "0" + time_component;
    else if (time_component.length < 2)
      time_component = time_component + "0";
    return time_component;
  }
  function geo_success(position) {
    var current_coords = {};
    if (position && position.coords) {
      current_coords = position.coords;
    } else {
      current_coords = DEFAULT_COORDS;
    }
    //document.getElementById('latitude').innerHTML = current_coords.latitude;
    //document.getElementById('longitude').innerHTML = current_coords.longitude;

    //document.getElementById('test1').innerText = JSON.stringify(current_coords.accuracy);
    //console.log(current_coords);
    var accuracy = current_coords.accuracy;
    if (accuracy <= 100) {
      zoomLevel = 2;
    } else if (accuracy <= 500) {
      zoomLevel = 3;
    } else if (accuracy <= 1000) {
      zoomLevel = 4;
    } else {
      zoomLevel = 5;
    }

    map_init(current_coords.latitude, current_coords.longitude);
  }
  function geo_error(error) {
    switch (error.code) {
      case error.TIMEOUT:
        messageLbl.innerHTML = "Timeout!";
        break;
    }
  }
  function get_pos() {
    if (!!navigator.geolocation) {
      wpid = navigator.geolocation.getCurrentPosition(geo_success, geo_error, {
        enableHighAccuracy: true,
        maximumAge: 30000,
        timeout: 5000
      });
    }
    else {
      messageLbl.innerHTML = "ERROR: Your Browser doesnt support the Geo Location API";
    }
  }

  function init() {
    messageLbl = document.getElementById('message');
    get_pos();
  }

  function goNext() {
    if (currentAddr) {
      location.href = '/test5_1?addr=' + currentAddr;
    } else {
      alert('위치를 확인해주세요');
    }
  }

</script>
